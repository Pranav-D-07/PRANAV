<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MediMind AI</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>MediMind ðŸ§ </h1>
            <p>AI Health Assistant</p>
        </div>
        <div class="chat-box" id="chat-box">
            <div class="msg ai-msg">Hello! How are you feeling today?</div>
        </div>
        <div class="input-area">
            <input type="text" id="user-input" placeholder="Type here (e.g., 'I have a fever')..." onkeypress="handleKey(event)">
            <button onclick="sendMessage()">Send</button>
        </div>
        <button class="reset-btn" onclick="location.reload()">Reset Chat</button>
    </div>

    <script>
        async function sendMessage() {
            let input = document.getElementById("user-input");
            let text = input.value.trim();
            if (!text) return;

            addMessage(text, "user-msg");
            input.value = "";

            let response = await fetch("/analyze", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ symptoms: text })
            });

            let result = await response.json();
            if (!result || !result.diagnosis || result.diagnosis.length === 0) {
                addMessage('Sorry, I could not analyze that. Please try again.', 'ai-msg');
                return;
            }
            let diag = result.diagnosis[0];

            // normalize condition and check for analyzing prompt
            let cond = (diag.condition || '').toString().trim().toLowerCase();
            if (cond.startsWith('analyz')) {
                addMessage(diag.recommendation || result.recommendation || 'Can you clarify?', 'ai-msg');
            } else {
                // show top diagnosis plus recommendation; fall back to a safe message if missing
                let reco = diag.recommendation || result.recommendation || 'Please consult a doctor for confirmation.';
                addMessage(`<strong>Diagnosis:</strong> ${diag.condition} (${diag.probability})<br>${reco}`, 'ai-msg');
            }
        }

        function addMessage(text, className) {
            let box = document.getElementById("chat-box");
            let div = document.createElement("div");
            div.className = `msg ${className}`;
            div.innerHTML = text;
            box.appendChild(div);
            box.scrollTop = box.scrollHeight;
        }

        function handleKey(e) {
            if (e.key === "Enter") sendMessage();
        }
    </script>
</body>
</html>